{% extends "base.html" %}

{% block title %}ç¿’æ…£ä½œæˆãƒ»ç·¨é›†{% endblock %}

{% block content %}
<h2>{% if form.instance.pk %}ç¿’æ…£ç·¨é›†{% else %}ç¿’æ…£ä½œæˆ{% endif %}</h2>

<form method="POST" onsubmit="return validateAndConfirm(event);">
  {% csrf_token %}

  <!-- ç¿’æ…£å -->
  <div class="mb-3">
    <label for="{{ form.habit_name.id_for_label }}" class="form-label">ç¿’æ…£å</label>
    {{ form.habit_name }}
    {% for error in form.habit_name.errors %}
      <div class="text-danger small">{{ error }}</div>
    {% endfor %}
  </div>

  <!-- ç´ã¥ãç›®æ¨™ -->
  <div class="mb-3">
    <label for="{{ form.goal.id_for_label }}" class="form-label">ã‚«ãƒ†ã‚´ãƒªãƒ¼</label>
    {{ form.goal }}
    {% for error in form.goal.errors %}
      <div class="text-danger small">{{ error }}</div>
    {% endfor %}
  </div>

  <!-- ğŸ¯ ç›®æ¨™ï¼ˆæ•°å€¤ + å˜ä½ + é »åº¦ï¼‰ -->
  <div class="mb-3">
    <label class="form-label">ç›®æ¨™</label>
    <div class="d-flex gap-2 flex-wrap">
      <div>
        {{ form.target_value }}
      </div>
      <div>
        {{ form.target_unit }}
      </div>
      <div>
        {{ form.target_frequency }}
      </div>
    </div>

    <!-- âœ¨ å€‹åˆ¥ã‚¨ãƒ©ãƒ¼è¡¨ç¤º -->
    {% for error in form.target_value.errors %}
      <div class="text-danger small">{{ error }}</div>
    {% endfor %}
    {% for error in form.target_unit.errors %}
      <div class="text-danger small">{{ error }}</div>
    {% endfor %}
    {% for error in form.target_frequency.errors %}
      <div class="text-danger small">{{ error }}</div>
    {% endfor %}
  </div>

<!-- ğŸ—“ï¸ å®Ÿæ–½æ›œæ—¥ï¼ˆãƒã‚§ãƒƒã‚¯ãƒœã‚¿ãƒ³é¢¨ï¼‹å…¨é¸æŠ/å…¨è§£é™¤ï¼‰ -->
<div class="mb-3">
  <label class="form-label">å®Ÿæ–½æ›œæ—¥</label>

  <!-- å…¨é¸æŠãƒ»å…¨è§£é™¤ -->
  <button type="button" id="select-all" class="btn btn-outline-success btn-sm ms-2">å…¨é¸æŠ</button>
  <button type="button" id="deselect-all" class="btn btn-outline-danger btn-sm ms-2">å…¨è§£é™¤</button>

  <!-- æ‰‹å‹•ã§æ›œæ—¥ã‚’æç”» -->
  <div class="d-flex flex-wrap gap-2">
    {% for day in "æœˆç«æ°´æœ¨é‡‘åœŸæ—¥" %}
      <div class="form-check form-check-inline">
        <input class="btn-check schedule-day" type="checkbox" name="schedule_days"
               value="{{ day }}"
               id="schedule_{{ day }}"
               {% if day in form.data.schedule_days or day in form.initial.schedule_days %}checked{% endif %}>
        <label class="btn btn-outline-primary btn-sm" for="schedule_{{ day }}">{{ day }}</label>
      </div>
    {% endfor %}
  </div>

  {% for error in form.schedule_days.errors %}
    <div class="text-danger small">{{ error }}</div>
  {% endfor %}
</div>



  <!-- ğŸŒŸ ã‚¢ã‚¤ã‚³ãƒ³ -->
  <div class="mb-3">
    <label for="{{ form.icon.id_for_label }}" class="form-label">ã‚¢ã‚¤ã‚³ãƒ³</label>
    {{ form.icon }}
    {% for error in form.icon.errors %}
      <div class="text-danger small">{{ error }}</div>
    {% endfor %}
  </div>

  <!-- âœ… ä¿å­˜ãƒ»æˆ»ã‚‹ -->
  <button type="submit" class="btn btn-primary">ä¿å­˜</button>
  <a href="{% url 'habit_list' %}" class="btn btn-secondary">æˆ»ã‚‹</a>
</form>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const checkboxes = document.querySelectorAll('.schedule-day'); // â† classæŒ‡å®šã«å¤‰æ›´ï¼

    document.getElementById("select-all").addEventListener("click", () => {
      checkboxes.forEach(cb => cb.checked = true);
    });

    document.getElementById("deselect-all").addEventListener("click", () => {
      checkboxes.forEach(cb => cb.checked = false);
    });
  });

  function validateAndConfirm(event) {
    const form = event.target.closest("form");
    const requiredFields = form.querySelectorAll("input[required], select[required], textarea[required]");
    let isValid = true;

    requiredFields.forEach(field => {
      if (!field.value.trim()) {
        isValid = false;
      }
    });

    if (!isValid) {
      alert("æœªå…¥åŠ›ã®é …ç›®ãŒã‚ã‚Šã¾ã™ã€‚ã™ã¹ã¦å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");
      event.preventDefault();
      return false;
    }

    return confirm("æœ¬å½“ã«ã“ã®å†…å®¹ã§ä¿å­˜ã—ã¾ã™ã‹ï¼Ÿ");
  }
</script>

{% endblock %}
